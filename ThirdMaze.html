<!DOCTYPE html>
<html lang="en">
<head>
    <!--Pictures were generated by Midjourney-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Third Maze</title>
    <style>
        body{
            margin: 0;
            padding: 0;
            font-family:'Times New Roman', Times, serif;
        }
        h1, h2, .display{
            margin-left: auto;
            margin-right: auto;
        }
        h1{
            font-size: 100px;
            color: white;
        }
        h2{
            font-size: 65px;
            color: white;
        }
        button{
            background-color:rgb(181, 181, 189);
        }
        button:hover{
            background-color:rgb(127, 127, 135);
            color: white;
        }

        .title{
            background-image: url(Aurora.JPG);
            background-attachment: fixed;
            background-repeat: no-repeat;
            background-size: cover;
            top: 0;
            height:  100vh;
            box-shadow: 0px 10px 10px darkgrey;
        }

        .display{
            display: grid;
            grid-template-rows:  repeat(2, 1fr);
            grid-template-columns:  repeat(4, 1fr);
            width: 75%;
            border: 7px solid rgb(38, 50, 50);
            background-color: rgb(38, 50, 50);
            min-width: 250px;
        }
        #mazeImage{
            grid-row-start: 1;
            grid-row-end: 3;
            grid-column-start: 1;
            grid-column-end: 4;
            width: 100%;
        }
        #left{
            grid-row-start: 3;
            grid-row-end: 4;
            grid-column-start: 1;
            grid-column-end: 2;
            min-height: 30px;
            max-height: 40px;
        } 
        #straight{
            grid-row-start: 3;
            grid-row-end: 4;
            grid-column-start: 2;
            grid-column-end: 3;
            min-height: 30px;
            max-height: 40px;
        } 
        #right{
            grid-row-start: 3;
            grid-row-end: 4;
            grid-column-start: 2;
            grid-column: 3;
            min-height: 30px;
            max-height: 40px;
        }
        .sidepanel{
            grid-row-start: 1;
            grid-row-end: 3;
            grid-column-start: 4;
            grid-column-end: 5;
            background-color:rgb(38, 50, 50);
            color: white;
            overflow: auto;
            overflow-x: hidden;
        }
        #notes{
            max-width: 100%;
            min-width: 90%;
            min-height: 25%;
            max-height: 45%;
            visibility: hidden;
        }
        #key{
            background-color: white;
            color: black;
            max-width: 90%;
            min-width: 80%;
            min-height: 25%;
            max-height: 45%;
            visibility: hidden;
            overflow: auto;
        }

        .instructions{
            margin: 10px;
        }

    </style>
</head>
<body>
    <div class="title">
        <br>
        <br>
        <br>
        <h1 align="center">Stage Three:</h1>
        <h2 align = "center">Reaching the Top</h2>
        <br>
    </div>
    <br>
    <br>
    <div class="instructions">
        <p margin="20px">Welcome to the third and final maze!  Click different spots on the image to discover what you can, and use the buttons to navigate through the maze.  Be careful, though--one wrong move and you'll have to start over!</p>
        <p>This maze will be the hardest one yet:  unlike the other two, no path ends until after the fifth crossroad.  In other words, you will not know if you made a wrong move until the very end of the maze.</p>
    </div>

    <div class="display" align="center">
        <img id="mazeImage" src="GrayOneFinal.JPG">
        <button id="left" class="button">Left</button>
        <button id="straight" class="button">Straight</button>
        <button id="right" class="button">Right</button>
        <div class="sidepanel" id="sidePanel">
            <p>Clues:  </p>
            <textarea id="notes">SEAL HARES SLEPT A SPELL&#13;&#10SIGH AS A LIGHT FELL&#13;&#10STARS RISE, ALL ARE RIGHT&#13;&#10RISE STARS, RAISE A SIGHT
            </textarea>
            <div id="key">KEY â€“ Each correct letter is the first letter of one of the directions (left, right, straight)
                <br>So how is the KEY a key to that weird poem?
                <br>Hint:  You found the decoding instructions in the trek up the mountain (stage two), right?
            </div>
        </div>
    </div>



    <script defer>
        
let left = document.getElementById("left");
let straight = document.getElementById("straight");
let right = document.getElementById("right");
let buttons = document.querySelectorAll(".button");//MAKE BUTTON CLASS
let mazeImage = document.getElementById("mazeImage");
let notes = document.getElementById("notes");
let scene = 1;
        //First, fixing display
        let sidepanel = document.getElementById("sidePanel");
        sidepanel.style.maxHeight = mazeImage.height +"px";


//Clicking for clues
mazeImage.onclick = function(){
    let x = event.offsetX;
    let y = event.offsetY;
    console.log(x, y);
    console.log(mazeImage.width +", "+ mazeImage.height);
    if (scene == 1){
        //clue
        if(x>0.49*mazeImage.width && x<0.56*mazeImage.width && y>0.29*mazeImage.height && y<0.31*mazeImage.height){
            console.log("Success!");
            key.style.visibility = "visible";
        }
        //notes
        if(x>0.41*mazeImage.width && x<0.44*mazeImage.width && y>0.35*mazeImage.height && y<0.40*mazeImage.height){
            notes.style.visibility = "visible";
        }
    }
}

let fail = function(){
    scene = 100;
    mazeImage.src = 'DeadEndOne.JPG';
    notes.style.visibility = "visible";
    key.style.visibility = "hidden";
    notes.value = "Sorry, it looks like you hit a dead end!  Refresh the page to try again.";
    left.style.visibility = "hidden";
    straight.style.visibility = "hidden";
    right.style.visibility = "hidden";
}
let clearInventory = function(){
    notes.style.visibility = "hidden";
    key.style.visibility = "hidden";
}

//Initializing counter
class values{
    value = 0;
}

let value = new values(0);

//Declaring event handlers
let clickOne;
let clickTwo;
let clickThree;
let clickFour;
let clickFive;

//Results of each choice
let choice = function(crossroad, event, correctButton){
    let button = event.target; //accesses the button element that triggered the function
    if(button.id == correctButton){ 
        console.log("Correct!"); 
        value.value += 1;
    }
    else{
        console.log("Incorrect.");
        value.value -= 1;
    }
    
    if(value.value != -10){
        if (crossroad == 1) {
            buttons.forEach(button =>{
                button.removeEventListener("click", clickOne); 
            });
            crossroadTwo();}
        if (crossroad == 2) {
            buttons.forEach(button =>{
                button.removeEventListener("click", clickTwo); 
            });
            crossroadThree();
        }
        if (crossroad == 3){
            buttons.forEach(button =>{
                button.removeEventListener("click", clickThree); 
            });
            crossroadFour();
        }
        if (crossroad == 4){
            buttons.forEach(button =>{
                button.removeEventListener("click", clickFour); 
            });
            crossroadFive();
        }
        if (crossroad == 5){
            buttons.forEach(button =>{
                button.removeEventListener("click", clickFive); 
            });
            end();
        }
    }
}

let crossroadOne = function(){
    //Setting up the scene
    scene = 1;
    mazeImage.src = "SnowOneFinal.JPG";

    //Navigation (see choice function)
    clickOne = (event) => choice(1, event, "left");

    buttons.forEach(button=>{//need to figure this out
        button.addEventListener("click", clickOne);
    });
}
let crossroadTwo = function(){
    //Setting up the scene
    scene = 2;
    mazeImage.src = "SnowTwo.JPG";

    //Navigation (see choice function)
    clickTwo = (event) => choice(2, event, "straight");

    buttons.forEach(button=>{//need to figure this out
        button.addEventListener("click", clickTwo);
    });
}

let crossroadThree = function(){
    //Setting up the scene
    scene = 3;
    mazeImage.src = "SnowThree.JPG";

    //Navigation (see choice function)
    clickThree = (event) => choice(3, event, "straight");

    buttons.forEach(button=>{//need to figure this out
        button.addEventListener("click", clickThree);
    });
}

let crossroadFour = function(){
    //Setting up the scene
    scene = 4;
    mazeImage.src = "SnowFour.JPG";

    //Navigation (see choice function)
    clickFour = (event) => choice(4, event, "right");

    buttons.forEach(button=>{//need to figure this out
        button.addEventListener("click", clickFour);
    });
}

let crossroadFive = function(){
    //Setting up the scene
    scene = 5;
    mazeImage.src = "SnowFive.JPG";

    //Navigation (see choice function)
    clickFive = (event) => choice(5, event, "right");

    buttons.forEach(button=>{//need to figure this out
        button.addEventListener("click", clickFive);
    });
}

let end = function(){
    //If successful
    if(value.value == 5){
        mazeImage.src = "SnowEnd.JPG";
        scene = 5;
        key.style.visibility = "hidden";
        notes.style.visibility = "visible";
        notes.value = "Congratulations, you have completed stage three of the maze and have reached the top of the mountain!  Click the link to continue.";
        left.style.visibility = "hidden";
        straight.innerHTML = "<a href='INSERTCORRECTLINKHERE.HTML'>Click here to move on</a>";//INSERT CORRECT LINK HERE
        right.style.visibility = "hidden";
    }
    //If not successful (fail)
    else{
        fail();
    }
}

    crossroadOne();
    </script>
</body>
</html>
